<!DOCTYPE html>
<html lang="bn"> <!-- Default language set to Bengali -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ঈদ মোবারক!</title> <!-- Title will be updated by JS -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet"> <!-- For English -->
    <style>
        body[lang="bn"] { font-family: 'Noto Sans Bengali', 'Arial', sans-serif; }
        body[lang="en"] { font-family: 'Roboto', 'Arial', sans-serif; }
        body {
            background: linear-gradient(to bottom, #001c00, #003800, #004d00);
            color: #f0e68c;
            text-align: center;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        #fireworksCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; }
        .container { background-color: rgba(1, 32, 1, 0.88); padding: 30px 35px; border-radius: 20px; box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3); max-width: 500px; width: 90%; border: 2px solid #ffd700; position: relative; z-index: 1; margin-top: 5vh; margin-bottom: 2vh; }
        #eidImage { max-width: 100%; height: auto; max-height: 280px; object-fit: contain; border-radius: 15px; margin-bottom: 25px; border: 4px solid #ffd700; box-shadow: 0 0 15px rgba(255, 215, 0, 0.5); background-color: #001000; }
        .greeting-message { font-size: 2.2em; font-weight: 700; color: #fff; margin-bottom: 25px; text-shadow: 2px 2px 5px rgba(0,0,0,0.7); animation: fadeInGrow 1.8s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        @keyframes fadeInGrow { 0% { opacity: 0; transform: scale(0.7) translateY(30px); } 100% { opacity: 1; transform: scale(1) translateY(0); } }
        .input-group { margin-top: 30px; margin-bottom: 15px; }
        label { display: block; margin-bottom: 10px; color: #f0e68c; font-weight: bold; font-size: 1.1em; }
        input[type="text"] { width: calc(100% - 26px); padding: 13px; margin-bottom: 18px; border: 2px solid #ffd700; border-radius: 10px; box-sizing: border-box; font-size: 1em; background-color: #002a00; color: #fff; }
        input[type="text"]::placeholder { color: #b0a060; }
        button#generateButton { background-color: #25D366; color: #fff; padding: 10px 18px; border: none; border-radius: 10px; cursor: pointer; font-size: 1.0em; font-weight: bold; transition: background-color 0.3s ease, transform 0.2s ease, opacity 0.3s ease; letter-spacing: 0.5px; box-shadow: 0 4px 8px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; width: 100%; max-width: 300px; margin: 0 auto; }
        button#generateButton svg { width: 22px; height: 22px; margin-right: 8px; fill: #fff; }
        button#generateButton:disabled { background-color: #cccccc; color: #666666; cursor: not-allowed; opacity: 0.7; }
        button#generateButton:disabled svg { fill: #666666; }
        button#generateButton:not(:disabled):hover { background-color: #1DAE54; transform: translateY(-2px) scale(1.03); box-shadow: 0 6px 12px rgba(0,0,0,0.4); }
        button#generateButton:not(:disabled):active { transform: translateY(0px) scale(1); }
        #statusMessage { padding: 10px; margin-top: 10px; margin-bottom: 10px; border-radius: 8px; font-size: 0.95em; display: none; opacity: 0; transition: opacity 0.5s ease-in-out; }
        #statusMessage.success { background-color: #1DAE54; color: white; } #statusMessage.error { background-color: #d9534f; color: white; } #statusMessage.info { background-color: #5bc0de; color: white; }
        #generatedLinkContainer { margin-top: 20px; padding: 18px; background-color: rgba(0, 0, 0, 0.4); border-radius: 10px; border: 1px solid #DAA520; display: none; }
        #generatedLinkContainer p { color: #f0e68c; margin-bottom: 10px; }
        #sharableLink { width: calc(100% - 125px); padding: 12px; border: 1px solid #DAA520; border-radius: 8px; margin-right: 10px; box-sizing: border-box; background-color: #002a00; color: #fff; }
        button#copyButton { padding: 12px 18px; background-color: #B8860B; color: #fff; font-size: 1em; border: none; border-radius: 8px; cursor: pointer; transition: background-color 0.3s ease; }
        button#copyButton:hover { background-color: #DAA520; }
        footer { margin-top: 20px; font-size: 0.9em; color: #f0e68c; position: relative; z-index: 1; padding-bottom: 20px; }
        .dateTimeEntry { margin-top: 5px; font-size: 0.95em; } .dateTimeEntry span { margin: 0 3px; }
    </style>
</head>
<body lang="bn">
    <canvas id="fireworksCanvas"></canvas>
    <audio id="backgroundMusic" src="eidmubarak.mp3" loop preload="auto"></audio>

    <div class="container">
        <div id="greetingMessage" class="greeting-message"></div>
        <img id="eidImage" src="" alt="Eid Mubarak Animation"> <!-- Initial src is empty -->
        <div class="input-group">
            <label for="userNameInput" data-lang-key="yourNameLabel">আপনার নাম লিখুন:</label>
            <input type="text" id="userNameInput" data-lang-key="namePlaceholder" placeholder="এখানে আপনার নাম দিন">
            <button id="generateButton" onclick="generateAndShareLink()" disabled>
                <svg viewBox="0 0 24 24"><path d="M12.04 2C6.58 2 2.13 6.45 2.13 11.91C2.13 13.66 2.61 15.31 3.4 16.78L2 22L7.31 20.62C8.72 21.37 10.33 21.82 12.04 21.82C17.5 21.82 21.95 17.37 21.95 11.91C21.95 6.45 17.5 2 12.04 2M12.04 19.96C10.6 19.96 9.22 19.57 8.03 18.89L7.62 18.65L4.32 19.53L5.22 16.32L4.96 15.89C4.14 14.57 3.74 13.07 3.74 11.91C3.74 7.36 7.48 3.62 12.04 3.62C16.6 3.62 20.34 7.36 20.34 11.91C20.34 16.47 16.6 19.96 12.04 19.96M17.01 14.34C16.76 14.22 15.56 13.64 15.34 13.56C15.13 13.48 14.97 13.44 14.82 13.67C14.67 13.91 14.17 14.51 14.03 14.67C13.88 14.82 13.73 14.84 13.48 14.72C13.24 14.6 12.26 14.27 11.11 13.24C10.21 12.43 9.62 11.47 9.44 11.18C9.27 10.89 9.41 10.76 9.53 10.64C9.64 10.53 9.78 10.34 9.91 10.19C10.03 10.04 10.07 9.93 10.15 9.76C10.23 9.59 10.19 9.45 10.11 9.33C10.04 9.22 9.46 7.78 9.22 7.23C8.99 6.68 8.76 6.72 8.59 6.72H8.24C8.06 6.72 7.78 6.8 7.54 7.04C7.3 7.28 6.67 7.85 6.67 8.99C6.67 10.13 7.58 11.21 7.7 11.37C7.82 11.53 9.32 13.83 11.59 14.73C12.14 14.96 12.58 15.09 12.95 15.19C13.48 15.32 14.25 15.25 14.58 14.94C14.96 14.58 15.34 14.04 15.49 13.81C15.65 13.59 15.57 13.48 15.5 13.38C15.42 13.28 15.2 13.2 14.95 13.08C14.7 12.96 17.25 14.46 17.01 14.34Z"/></svg>
                <span data-lang-key="shareButtonText">WhatsApp এ শেয়ার করুন</span>
            </button>
            <div id="statusMessage"></div>
        </div>

        <div id="generatedLinkContainer">
            <p data-lang-key="shareLinkManualText">এই লিঙ্কটি বন্ধুদের সাথে শেয়ার করুন (যদি অটো-শেয়ার কাজ না করে):</p>
            <input type="text" id="sharableLink" readonly>
            <button id="copyButton" onclick="copyLink()" data-lang-key="copyButtonText">কপি করুন</button>
        </div>
    </div>

    <footer>
        <p data-lang-key="eidWishesFooter">সবাইকে ঈদের আন্তরিক শুভেচ্ছা!</p>
        <div id="dateTimeDisplay">
            <div class="dateTimeEntry">
                <span id="currentTime"></span> | <span id="currentDate"></span>
            </div>
            <div class="dateTimeEntry">
                <span id="currentHijriDate">ইসলামী তারিখ পরীক্ষা করা হচ্ছে...</span>
            </div>
        </div>
    </footer>

    <script>
    // HijriDate Library v0.2.2 (Cleaned version)
    (function(global) { /* ... (HijriDate কোড আগের মতোই থাকবে) ... */
        var HijriDate = {};var floor = Math.floor;var replace = function(template, data) {return template.replace(/\{([\w\.]*)\}/g, function(str, key) {var keys = key.split("."),v = data[keys.shift()];for (var i = 0, l = keys.length; i < l; i++) v = v[keys[i]];return (typeof v !== "undefined" && v !== null) ? v : "";});};var monthDays = [30, 29, 30, 29, 30, 29, 30, 29, 30, 29, 30, 29];var monthNames = ["Muharram", "Safar", "Rabi'ul Awwal", "Rabi'ul Akhir", "Jamadil Awwal", "Jamadil Akhir", "Rajab", "Sha'ban", "Ramadhan", "Shawwal", "Dhul Qa'ada", "Dhul Hijja"];var dayNames = ["Ahad", "Ithnin", "Thulatha", "Arbia'a", "Khamees", "Jomu'a", "Sabt"]; var gLIMIT = 227015;
        var _HijriDate = function(year, month, date, hour, minute, second, millisecond) {if (year instanceof Date) {var gdate = year;var gYear = gdate.getFullYear(),gMonth = gdate.getMonth(),gDate = gdate.getDate();var julianDayNumber = floor((1461 * (gYear + 4800 + floor((gMonth - 14) / 12))) / 4) + floor((367 * (gMonth - 2 - 12 * (floor((gMonth - 14) / 12)))) / 12) - floor((3 * floor((gYear + 4900 + floor((gMonth - 14) / 12)) / 100)) / 4) + gDate - 32075;var l = julianDayNumber - 1948440 + 10632;var n = floor((l - 1) / 10631);l = l - 10631 * n + 354;var j = (floor((10985 - l) / 5316)) * (floor((50 * l) / 17719)) + (floor(l / 5670)) * (floor((43 * l) / 15238));l = l - (floor((30 - j) / 15)) * (floor((17719 * j) / 50)) - (floor(j / 16)) * (floor((15238 * j) / 43)) + 29;month = floor((24 * l) / 709); date = l - floor((709 * month) / 24); year = 30 * n + j - 30;
        this._date = date;this._month = month;this._year = year;this._hour = gdate.getHours();this._minute = gdate.getMinutes();this._second = gdate.getSeconds();this._millisecond = gdate.getMilliseconds();var tempGDate = this.toGlobalDate();this._day = tempGDate.getDay();return this;}
        this._date = date;this._month = month;this._year = year;this._hour = hour || 0;this._minute = minute || 0;this._second = second || 0;this._millisecond = millisecond || 0;var gdateInstance = this.toGlobalDate();this._day = gdateInstance.getDay();return this;};
        _HijriDate.prototype.getFullYear = function() { return this._year; };_HijriDate.prototype.getMonth = function() { return this._month; };_HijriDate.prototype.getDate = function() { return this._date; };_HijriDate.prototype.getHours = function() { return this._hour; };_HijriDate.prototype.getMinutes = function() { return this._minute; };_HijriDate.prototype.getSeconds = function() { return this._second; };_HijriDate.prototype.getMilliseconds = function() { return this._millisecond; };_HijriDate.prototype.getDay = function() { return this._day; };
        _HijriDate.prototype.toGlobalDate = function() {var y = this._year;var m = this._month;var d = this._date;var jd = floor((11 * y + 3) / 30) + 354 * y + 30 * m - floor((m - 1) / 2) + d + 1948440 - 386; var gYear, gMonth, gDate;var l,n,i,j;if (jd > 2299160) {l = jd + 68569;n = floor((4 * l) / 146097);l = l - floor((146097 * n + 3) / 4);i = floor((4000 * (l + 1)) / 1461001);l = l - floor((1461 * i) / 4) + 31;j = floor((80 * l) / 2447);gDate = l - floor((2447 * j) / 80);l = floor(j / 11);gMonth = j + 2 - 12 * l;gYear = 100 * (n - 49) + i + l;} else {j = jd + 1402;var k = floor((j - 1) / 1461);l = j - 1461 * k;n = floor((l - 1) / 365) - floor(l / 1461);i = l - 365 * n + 30;gDate = floor((80 * i) / 2447);gMonth = floor(gDate / 11) + i - floor((2447 * floor(gDate / 11)) / 80);gYear = 4 * k + n + floor(gMonth / 3) - 4716;gMonth = (gMonth + 1) % 13;if (gMonth === 0) gMonth = 1;} return new Date(gYear, gMonth - 1, gDate, this._hour, this._minute, this._second, this._millisecond);};
        _HijriDate.prototype.getMonthName = function() { return monthNames[this._month - 1]; };_HijriDate.prototype.getDayName = function() { return dayNames[this._day]; };
        HijriDate.JS = { convert: function(gDate) { return new _HijriDate(gDate); }};
        if (typeof module !== "undefined" && module.exports) { module.exports = HijriDate; } else if (typeof define === "function" && define.amd) { define(HijriDate); } else { global.HijriDate = HijriDate; }
    }(this));
    </script>

    <script>
        const translations={'bn':{'pageTitle':'ঈদ মোবারক!','greetingMessage':'ঈদ মোবারক!','greetingMessageFrom':'{name} এর পক্ষ থেকে, ঈদ মোবারক!','yourNameLabel':'আপনার নাম লিখুন:','namePlaceholder':'এখানে আপনার নাম দিন','shareButtonText':'WhatsApp এ শেয়ার করুন','shareLinkManualText':'এই লিঙ্কটি বন্ধুদের সাথে শেয়ার করুন (যদি অটো-শেয়ার কাজ না করে):','copyButtonText':'কপি করুন','eidWishesFooter':'সবাইকে ঈদের আন্তরিক শুভেচ্ছা!','timeLabel':'সময়','dateLabel':'তারিখ','hijriDateLabel':'ইসলামী তারিখ','hijriYearSuffix':'হিজরি','statusEnterName':'অনুগ্রহ করে আপনার নাম লিখুন।','statusShareOptions':'শুভেচ্ছা শেয়ার করার জন্য অপশন দেখানো হয়েছে!','statusShareError':'শেয়ার অপশন কাজ করেনি/বাতিল হয়েছে। লিঙ্ক কপি করুন।','statusNoAutoShare':'আপনার ব্রাউজার অটো-শেয়ার সাপোর্ট করে না। লিঙ্ক কপি করুন।','statusLinkCopied':'লিঙ্ক সফলভাবে কপি করা হয়েছে!','statusLinkCopiedFallback':'লিঙ্ক কপি করা হয়েছে (ফলব্যাক)!','statusCopyError':'দুঃখিত, লিঙ্ক কপি করা যায়নি। নিজে কপি করে নিন।','hijriDateLoading':'ইসলামী তারিখ পরীক্ষা করা হচ্ছে...','hijriDateError':'ইসলামী তারিখ রূপান্তরে ত্রুটি।','hijriCalcError':'হিজরি মাস গণনায় ত্রুটি।','hijriNotLoaded':'ইসলামী ক্যালকুলেটর লোড হয়নি।'},'en':{'pageTitle':'Eid Mubarak!','greetingMessage':'Eid Mubarak!','greetingMessageFrom':'Eid Mubarak from {name}!','yourNameLabel':'Enter your name:','namePlaceholder':'Enter your name here','shareButtonText':'Share on WhatsApp','shareLinkManualText':'Share this link with friends (if auto-share doesn\'t work):','copyButtonText':'Copy','eidWishesFooter':'Eid greetings to everyone!','timeLabel':'Time','dateLabel':'Date','hijriDateLabel':'Islamic Date','hijriYearSuffix':'AH','statusEnterName':'Please enter your name.','statusShareOptions':'Share options are shown!','statusShareError':'Share option failed/cancelled. Please copy the link.','statusNoAutoShare':'Your browser does not support auto-share. Please copy the link.','statusLinkCopied':'Link copied successfully!','statusLinkCopiedFallback':'Link copied (fallback)!','statusCopyError':'Sorry, could not copy the link. Please copy it manually.','hijriDateLoading':'Checking Islamic date...','hijriDateError':'Error in Islamic date conversion.','hijriCalcError':'Error in Hijri month calculation.','hijriNotLoaded':'Islamic calendar not loaded.'}};
        let currentLang='bn';let userTimeZone='Etc/UTC';let userLocale='bn-BD';
        const backgroundMusic=document.getElementById('backgroundMusic');const userNameInput=document.getElementById('userNameInput');const generateButton=document.getElementById('generateButton');const statusMessageDiv=document.getElementById('statusMessage');let statusTimeout;
        const currentTimeEl=document.getElementById('currentTime');const currentDateEl=document.getElementById('currentDate');const currentHijriDateEl=document.getElementById('currentHijriDate');const greetingMessageEl=document.getElementById('greetingMessage');
        let timeOffset=0;let initialTimeSynced=false;
        const bengaliHijriMonths=["মহররম","সফর","রবিউল আউয়াল","রবিউস সানি","জমাদিউল আউয়াল","জমাদিউস সানি","রজব","শাবান","রমজান","শাওয়াল","জ্বিলকদ","জ্বিলহজ্জ"];const englishHijriMonths=["Muharram","Safar","Rabi' al-awwal","Rabi' al-thani","Jumada al-awwal","Jumada al-thani","Rajab","Sha'ban","Ramadan","Shawwal","Dhu al-Qi'dah","Dhu al-Hijjah"];
        
        const eidGifList = [ /* তোমার রিপোজিটরি অনুযায়ী সঠিক ফাইলের নাম দাও */
            "eidmubarak.gif", "eidmubarak1.gif", "eidmubarak2.gif", "eidmubarak3.gif",
            "eidmubarak4.gif", "eidmubarak5.gif", "eidmubarak6.gif", "eidmubarak7.gif",
            "eidmubarak8.gif", "eidmubarak9.gif", "eidmubarak10.gif", "eidmubarak11.gif",
            "eidmubarak12.gif", "eidmubarak13.gif", "eidmubarak14.gif", "eidmubarak15.gif",
            "eidmubarak16.gif", "eidmubarak17.gif", "eidmubarak18.gif", "eidmubarak19.gif",
            "eidmubarak20.gif", "eidmubarak21.gif" // নিশ্চিত করো এই ফাইলটি আছে
        ];
        let currentGifIndex = 0; // প্রথম GIF এর জন্য ০ দিয়ে শুরু
        const gifChangeInterval = 1000; // প্রতি ০.১ সেকেন্ড (100ms)

        function changeEidGif() {
            const eidImageEl = document.getElementById('eidImage'); // ফাংশনের ভিতরে কল করা ভালো
            if (!eidImageEl || eidGifList.length === 0) {
                console.warn("Cannot change GIF: Image element not found or GIF list is empty.");
                return;
            }
            currentGifIndex = (currentGifIndex + 1) % eidGifList.length;
            const nextGifSrc = eidGifList[currentGifIndex];
            eidImageEl.src = nextGifSrc + '?t=' + new Date().getTime(); // ক্যাশ বাস্টিং
            console.log("Attempting to change GIF to:", eidImageEl.src);
        }

        function getTranslation(key,params={}){let text=translations[currentLang]?.[key]||translations['en']?.[key]||key;for(const param in params){text=text.replace(`{${param}}`,params[param]);}return text;}
        function applyTranslations(){document.querySelectorAll('[data-lang-key]').forEach(element=>{const key=element.getAttribute('data-lang-key');if(element.tagName==='INPUT'&&element.hasAttribute('placeholder')){element.placeholder=getTranslation(key);}else{element.textContent=getTranslation(key);}});document.title=getTranslation('pageTitle');}
        function toNativeNumeral(numStr,lang){if(lang.startsWith('bn')){const bengaliDigits=['০','১','২','৩','৪','৫','৬','৭','৮','৯'];return String(numStr).split('').map(digit=>/\d/.test(digit)?bengaliDigits[parseInt(digit)]:digit).join('');}return String(numStr);}
        async function fetchUserLocationAndSetLanguage(){let browserLang=(navigator.languages&&navigator.languages[0])||navigator.language||'bn';if(browserLang.toLowerCase().startsWith('en')){currentLang='en';userLocale='en-US';}else if(browserLang.toLowerCase().startsWith('bn')){currentLang='bn';userLocale='bn-BD';}else{currentLang='en';userLocale='en-US';}document.body.lang=currentLang;console.log(`Browser language detected: ${browserLang}, Using app language: ${currentLang}`);applyTranslations();try{const response=await fetch('https://ip-api.com/json/?fields=status,message,timezone,countryCode');if(!response.ok)throw new Error(`IP API HTTP error! status: ${response.status}`);const data=await response.json();if(data.status==='success'&&data.timezone){userTimeZone=data.timezone;console.log('User timezone from IP API:',userTimeZone);}else{console.warn('Failed to get timezone from IP API, using default UTC. Message:',data.message);userTimeZone='Etc/UTC';}}catch(error){console.error("Error fetching user location/timezone from IP API:",error);userTimeZone='Etc/UTC';}await fetchCorrectTime();}
        async function fetchCorrectTime(){try{const response=await fetch(`https://worldtimeapi.org/api/timezone/${userTimeZone}`);if(!response.ok){if(userTimeZone!=='Etc/UTC'){console.warn(`Timezone ${userTimeZone} not found on worldtimeapi, falling back to UTC.`);userTimeZone='Etc/UTC';return await fetchCorrectTime();}throw new Error(`WorldTimeAPI HTTP error! status: ${response.status}`);}const data=await response.json();const serverTime=new Date(data.utc_datetime);const clientTimeAtFetch=new Date();timeOffset=serverTime.getTime()-clientTimeAtFetch.getTime();initialTimeSynced=true;console.log(`Successfully synced time with server for timezone ${data.timezone}. Offset: ${timeOffset} ms`);}catch(error){console.error("Failed to fetch correct time from WorldTimeAPI:",error);timeOffset=0;initialTimeSynced=false;}updateTimeDate();}
        function initializeDateTimeDisplay(){if(!currentTimeEl||!currentDateEl||!currentHijriDateEl){return;}updateTimeDate();setInterval(updateTimeDate,1000);}
        function updateTimeDate(){const clientNow=new Date();const correctedNow=new Date(clientNow.getTime()+timeOffset);const timeOptions={hour:'numeric',minute:'2-digit',second:'2-digit',hour12:true,timeZone:userTimeZone};let timeString=correctedNow.toLocaleTimeString(userLocale,timeOptions);if(currentTimeEl)currentTimeEl.textContent=`${getTranslation('timeLabel')}: ${timeString}`;const dateOptions={day:'numeric',month:'long',year:'numeric',timeZone:userTimeZone};let dateString=correctedNow.toLocaleDateString(userLocale,dateOptions);if(currentDateEl)currentDateEl.textContent=`${getTranslation('dateLabel')}: ${dateString}`;if(currentHijriDateEl){if(typeof HijriDate!=='undefined'&&HijriDate.JS&&typeof HijriDate.JS.convert==='function'){try{const hijriInstance=HijriDate.JS.convert(correctedNow);if(hijriInstance&&typeof hijriInstance.getDate==='function'){const hijriDay=toNativeNumeral(hijriInstance.getDate(),currentLang);const hijriMonthIndex=hijriInstance.getMonth()-1;const hijriMonths=currentLang==='bn'?bengaliHijriMonths:englishHijriMonths;if(hijriMonthIndex>=0&&hijriMonthIndex<hijriMonths.length){const hijriMonthName=hijriMonths[hijriMonthIndex];const hijriYear=toNativeNumeral(hijriInstance.getFullYear(),currentLang);currentHijriDateEl.textContent=`${getTranslation('hijriDateLabel')}: ${hijriDay} ${hijriMonthName}, ${hijriYear} ${getTranslation('hijriYearSuffix')}`;}}else{throw new Error("HijriDate conversion invalid object.");}}catch(e){currentHijriDateEl.textContent=getTranslation('hijriDateError');}}else{currentHijriDateEl.textContent=getTranslation('hijriNotLoaded');}}}

        window.onload = async function() {
            await fetchUserLocationAndSetLanguage(); 
            const eidImageEl = document.getElementById('eidImage'); // Declare here after DOM is ready

            const urlParams = new URLSearchParams(window.location.search);
            const sharerNameParam = urlParams.get('name');
            
            if (sharerNameParam) {
                greetingMessageEl.textContent = getTranslation('greetingMessageFrom', {name: decodeURIComponent(sharerNameParam)});
            } else {
                greetingMessageEl.textContent = getTranslation('greetingMessage');
            }
            greetingMessageEl.style.animation = 'none';
            greetingMessageEl.offsetHeight;
            greetingMessageEl.style.animation = null;

            if (backgroundMusic) {
                backgroundMusic.play().catch(error => { console.warn("Autoplay was prevented by the browser.", error); });
            }

            generateButton.disabled = true;
            startFireworks();
            animateFireworks();
            initializeDateTimeDisplay(); 

            // GIF পরিবর্তনের জন্য সেটআপ
            if (eidImageEl && eidGifList.length > 0) {
                // প্রথম GIF টি সেট করার জন্য currentGifIndex = -1 এবং changeEidGif() কল করা
                currentGifIndex = -1; // যাতে প্রথম কলে 0 হয়
                changeEidGif(); // প্রথম GIF লোড করার জন্য
                setInterval(changeEidGif, gifChangeInterval); 
                console.log("GIF slideshow initialized.");
            } else {
                console.warn("Eid image element not found or GIF list is empty. GIF slideshow not started.");
                if(eidImageEl) eidImageEl.src = "eidmubarak.gif"; // একটি ডিফল্ট ফলব্যাক যদি তালিকা খালি থাকে
            }
        };

        // ... (বাকি JavaScript ফাংশনগুলো অপরিবর্তিত থাকবে) ...
        userNameInput.addEventListener('input', function() {
            if (userNameInput.value.trim() !== "") { generateButton.disabled = false; }
            else { generateButton.disabled = true; }
        });
        function showStatusMessage(messageKey, type = 'info', duration = 3000, params = {}) { clearTimeout(statusTimeout); statusMessageDiv.textContent = getTranslation(messageKey, params); statusMessageDiv.className = ''; statusMessageDiv.classList.add(type); statusMessageDiv.style.display = 'block'; setTimeout(() => { statusMessageDiv.style.opacity = '1'; }, 10); statusTimeout = setTimeout(() => { statusMessageDiv.style.opacity = '0'; setTimeout(() => { statusMessageDiv.style.display = 'none'; }, 500); }, duration); }
        async function generateAndShareLink() { const userName = userNameInput.value.trim(); if (userName === "") { showStatusMessage("statusEnterName", "error"); return; } if (backgroundMusic && backgroundMusic.paused) { backgroundMusic.play().catch(error => { console.warn("Music play on interaction failed: ", error); }); } const currentUrl = new URL(window.location.href); currentUrl.searchParams.set('name', userName); const newLink = currentUrl.toString(); const sharerNameForMessage = decodeURIComponent(userName); const shareText = getTranslation('greetingMessageFrom', {name: sharerNameForMessage}) + ` ${getTranslation('pageTitle')}! ${newLink}`; if (navigator.share) { try { await navigator.share({ title: getTranslation('pageTitle'), text: shareText, url: newLink }); showStatusMessage('statusShareOptions', 'success', 4000); document.getElementById('generatedLinkContainer').style.display = 'none'; } catch (error) { showManualLink(newLink); showStatusMessage('statusShareError', 'info', 4000); } } else { showManualLink(newLink); showStatusMessage('statusNoAutoShare', 'info', 4000); } userNameInput.value = ''; generateButton.disabled = true; }
        function showManualLink(link) { const sharableLinkInput = document.getElementById('sharableLink'); sharableLinkInput.value = link; document.getElementById('generatedLinkContainer').style.display = 'block'; }
        function copyLink() { const sharableLinkInput = document.getElementById('sharableLink'); sharableLinkInput.select(); sharableLinkInput.setSelectionRange(0, 99999); try { navigator.clipboard.writeText(sharableLinkInput.value) .then(() => { showStatusMessage("statusLinkCopied", "success"); }) .catch(err => { if(document.execCommand('copy')) { showStatusMessage("statusLinkCopiedFallback", "success"); } else { showStatusMessage("statusCopyError", "error", 4000); } }); } catch (err) { if(document.execCommand('copy')) { showStatusMessage("statusLinkCopiedFallback", "success"); } else { showStatusMessage("statusCopyError", "error", 4000); } } }
        const canvas = document.getElementById('fireworksCanvas'); const ctx = canvas.getContext('2d'); canvas.width = window.innerWidth; canvas.height = window.innerHeight; let fireworks = []; let particles = []; const fireworkLaunchProbability = 0.025; const maxFireworksAtOnce = 8;
        function Firework(startX, startY, targetX, targetY) { this.x = startX; this.y = startY; this.startX = startX; this.startY = startY; this.targetX = targetX; this.targetY = targetY; this.distanceToTarget = Math.sqrt(Math.pow(targetX - startX, 2) + Math.pow(targetY - startY, 2)); this.distanceTraveled = 0; this.trail = []; this.angle = Math.atan2(targetY - startY, targetX - startX); this.speed = 4; this.acceleration = 1.05 + Math.random() * 0.03; this.brightness = Math.random() * 70 + 50; this.color = `hsl(${Math.random()*360}, 100%, ${this.brightness}%)`; this.lineWidth = Math.random()*2.5+1.5; } Firework.prototype.update = function(index) { this.trail.push({x:this.x, y:this.y}); if (this.trail.length > 8) this.trail.shift(); this.speed *= this.acceleration; let vx = Math.cos(this.angle) * this.speed; let vy = Math.sin(this.angle) * this.speed; this.distanceTraveled = Math.sqrt(Math.pow(this.x - this.startX, 2) + Math.pow(this.y - this.startY, 2)); if (this.distanceTraveled >= this.distanceToTarget || this.y < this.targetY) { createParticles(this.targetX, this.targetY, this.color); fireworks.splice(index, 1); } else { this.x += vx; this.y += vy; } }; Firework.prototype.draw = function() { ctx.beginPath(); if(this.trail.length > 0) { ctx.moveTo(this.trail[this.trail.length-1].x, this.trail[this.trail.length-1].y); } else { ctx.moveTo(this.x - Math.cos(this.angle)*10, this.y - Math.sin(this.angle)*10); } ctx.lineTo(this.x, this.y); ctx.strokeStyle = this.color; ctx.lineWidth = this.lineWidth; ctx.stroke(); ctx.beginPath(); ctx.arc(this.x, this.y, this.lineWidth+2, 0, Math.PI*2); ctx.fillStyle = this.color.replace(')', ', 0.4)').replace('hsl', 'hsla'); ctx.fill(); };
        function Particle(x,y,color) { this.x=x; this.y=y; this.angle=Math.random()*Math.PI*2; this.speed=Math.random()*18+5; this.friction=0.96+Math.random()*0.01; this.gravity=0.9+Math.random()*0.6; this.alpha=1; this.decay=Math.random()*0.025+0.020; this.color=color; this.size=Math.random()*3.5+1.5; } Particle.prototype.update = function(index) { this.speed *= this.friction; this.x += Math.cos(this.angle)*this.speed; this.y += Math.sin(this.angle)*this.speed + this.gravity; this.alpha -= this.decay; if (this.alpha <= this.decay) { particles.splice(index,1); } }; Particle.prototype.draw = function() { ctx.save(); ctx.globalAlpha = this.alpha; ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI*2, false); ctx.fillStyle = this.color; ctx.fill(); ctx.restore(); };
        function createParticles(x,y,color) { let particleCount = 120 + Math.floor(Math.random()*60); while(particleCount--) { particles.push(new Particle(x,y,color)); } } function launchFirework() { if (fireworks.length < maxFireworksAtOnce && Math.random() < fireworkLaunchProbability) { const startX = Math.random()*canvas.width/2 + canvas.width/4; const startY = canvas.height; const targetX = Math.random()*canvas.width; const targetY = Math.random()*(canvas.height/1.8); fireworks.push(new Firework(startX,startY,targetX,targetY)); } }
        function startFireworks() { for(let i=0; i<4+Math.floor(Math.random()*4); i++) { setTimeout(() => { const startX = Math.random()*canvas.width/2 + canvas.width/4; const startY = canvas.height; const targetX = Math.random()*canvas.width; const targetY = Math.random()*(canvas.height/1.8); fireworks.push(new Firework(startX,startY,targetX,targetY)); }, i*(150+Math.random()*200)); } }
        function animateFireworks() { requestAnimationFrame(animateFireworks); ctx.fillStyle = 'rgba(0,0,0,0.12)'; ctx.fillRect(0,0,canvas.width,canvas.height); launchFirework(); fireworks.forEach((firework,index) => {firework.update(index); firework.draw();}); particles.forEach((particle,index) => {particle.update(index); particle.draw();}); } window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; });
    </script>
</body>
</html>
